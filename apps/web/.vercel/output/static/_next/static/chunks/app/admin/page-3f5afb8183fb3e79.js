(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{4497:(e,t,r)=>{Promise.resolve().then(r.bind(r,2914))},2914:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(7437),n=r(2265),a=r(510);let i=r(357).env.NEXT_PUBLIC_API_URL||"/api/v1";function o(){let{user:e,token:t,loading:r}=(0,a.a)(),[o,l]=(0,n.useState)(null),[d,c]=(0,n.useState)([]),[h,x]=(0,n.useState)([]),[p,u]=(0,n.useState)("stats"),[g,y]=(0,n.useState)(null);(0,n.useEffect)(()=>{t&&(null==e?void 0:e.is_admin)&&(m(),v(),j())},[t,e]);let m=async()=>{try{let e=await fetch("".concat(i,"/admin/stats"),{headers:{Authorization:"Bearer ".concat(t)}});e.ok&&l(await e.json())}catch(e){console.error("Failed to fetch stats:",e)}},v=async()=>{try{let e=await fetch("".concat(i,"/admin/users"),{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){let t=await e.json();c(t.items)}}catch(e){console.error("Failed to fetch users:",e)}},j=async()=>{try{let e=await fetch("".concat(i,"/admin/sensors"),{headers:{Authorization:"Bearer ".concat(t)}});if(e.ok){let t=await e.json();x(t.items)}}catch(e){console.error("Failed to fetch sensors:",e)}},f=async(e,r)=>{try{(await fetch("".concat(i,"/admin/users/").concat(e),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({is_admin:r})})).ok&&v()}catch(e){console.error("Failed to update user:",e)}},b=async(e,r)=>{try{(await fetch("".concat(i,"/admin/sensors/").concat(e,"/certify"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},body:JSON.stringify({certified:"certified"===r,status:r})})).ok&&j()}catch(e){console.error("Failed to update sensor status:",e)}},A=async e=>{if(confirm("Are you sure you want to delete this sensor?"))try{(await fetch("".concat(i,"/admin/sensors/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}})).ok&&(j(),m())}catch(e){console.error("Failed to delete sensor:",e)}};return r?(0,s.jsx)("div",{className:"container",style:{padding:"80px 24px",textAlign:"center"},children:(0,s.jsx)("div",{className:"spinner"})}):e?e.is_admin?(0,s.jsxs)("div",{className:"container",style:{padding:"40px 24px"},children:[(0,s.jsx)("h1",{style:{marginBottom:"32px"},children:"Admin Dashboard"}),(0,s.jsx)("div",{style:{display:"flex",gap:"8px",marginBottom:"32px"},children:["stats","users","sensors"].map(e=>(0,s.jsx)("button",{onClick:()=>u(e),className:"category-pill ".concat(p===e?"active":""),style:{textTransform:"capitalize"},children:e},e))}),"stats"===p&&o&&(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"24px"},children:[(0,s.jsxs)("div",{className:"sensor-card",children:[(0,s.jsx)("div",{style:{fontSize:"2.5rem",fontWeight:"700",color:"var(--accent-primary)"},children:o.total_users}),(0,s.jsx)("div",{style:{color:"var(--text-secondary)"},children:"Total Users"})]}),(0,s.jsxs)("div",{className:"sensor-card",children:[(0,s.jsx)("div",{style:{fontSize:"2.5rem",fontWeight:"700",color:"var(--accent-secondary)"},children:o.total_sensors}),(0,s.jsx)("div",{style:{color:"var(--text-secondary)"},children:"Total Sensors"})]}),(0,s.jsxs)("div",{className:"sensor-card",children:[(0,s.jsx)("div",{style:{fontSize:"2.5rem",fontWeight:"700",color:"var(--success)"},children:o.total_versions}),(0,s.jsx)("div",{style:{color:"var(--text-secondary)"},children:"Total Versions"})]}),(0,s.jsxs)("div",{className:"sensor-card",children:[(0,s.jsx)("div",{style:{fontSize:"2.5rem",fontWeight:"700",color:"var(--warning)"},children:o.total_downloads.toLocaleString()}),(0,s.jsx)("div",{style:{color:"var(--text-secondary)"},children:"Total Downloads"})]})]}),"users"===p&&(0,s.jsx)("div",{style:{background:"var(--bg-card)",borderRadius:"var(--border-radius)",overflow:"hidden"},children:(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{style:{borderBottom:"1px solid var(--border-color)"},children:[(0,s.jsx)("th",{style:{padding:"16px",textAlign:"left"},children:"User"}),(0,s.jsx)("th",{style:{padding:"16px",textAlign:"left"},children:"Email"}),(0,s.jsx)("th",{style:{padding:"16px",textAlign:"center"},children:"Admin"}),(0,s.jsx)("th",{style:{padding:"16px",textAlign:"right"},children:"Actions"})]})}),(0,s.jsx)("tbody",{children:d.map(t=>(0,s.jsxs)("tr",{style:{borderBottom:"1px solid var(--border-color)"},children:[(0,s.jsx)("td",{style:{padding:"16px"},children:(0,s.jsx)("strong",{children:t.github_username||t.full_name||"Unknown"})}),(0,s.jsx)("td",{style:{padding:"16px",color:"var(--text-secondary)"},children:t.email}),(0,s.jsx)("td",{style:{padding:"16px",textAlign:"center"},children:t.is_admin?"✓":""}),(0,s.jsx)("td",{style:{padding:"16px",textAlign:"right"},children:t.id!==e.id&&(0,s.jsx)("button",{onClick:()=>f(t.id,!t.is_admin),className:"btn btn-outline",style:{padding:"4px 12px",fontSize:"0.8rem"},children:t.is_admin?"Remove Admin":"Make Admin"})})]},t.id))})]})}),"sensors"===p&&(0,s.jsx)("div",{style:{background:"var(--bg-card)",borderRadius:"var(--border-radius)",overflow:"hidden"},children:(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{style:{borderBottom:"1px solid var(--border-color)"},children:[(0,s.jsx)("th",{style:{padding:"16px",textAlign:"left"},children:"Sensor"}),(0,s.jsx)("th",{style:{padding:"16px",textAlign:"left"},children:"Status"}),(0,s.jsx)("th",{style:{padding:"16px",textAlign:"center"},children:"Versions"}),(0,s.jsx)("th",{style:{padding:"16px",textAlign:"center"},children:"Downloads"}),(0,s.jsx)("th",{style:{padding:"16px",textAlign:"right"},children:"Actions"})]})}),(0,s.jsxs)("tbody",{children:[h.map(e=>(0,s.jsxs)("tr",{style:{borderBottom:"1px solid var(--border-color)"},children:[(0,s.jsxs)("td",{style:{padding:"16px"},children:[(0,s.jsx)("div",{style:{fontWeight:"600"},children:e.display_name}),e.github_pr_url&&(0,s.jsx)("a",{href:e.github_pr_url,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"0.8rem",color:"var(--accent-primary)"},children:"View PR ↗"})]}),(0,s.jsx)("td",{style:{padding:"16px"},children:"certified"===e.status?(0,s.jsx)("span",{className:"badge badge-certified",children:"Certified"}):"approved"===e.status?(0,s.jsx)("span",{className:"badge badge-approved",children:"Approved"}):(0,s.jsx)("span",{className:"badge badge-pending",children:"Pending"})}),(0,s.jsx)("td",{style:{padding:"16px",textAlign:"center"},children:e.version_count}),(0,s.jsx)("td",{style:{padding:"16px",textAlign:"center"},children:e.total_downloads}),(0,s.jsx)("td",{style:{padding:"16px",textAlign:"right"},children:(0,s.jsxs)("div",{style:{display:"flex",gap:"8px",justifyContent:"flex-end"},children:["pending"===e.status&&(0,s.jsx)("button",{onClick:()=>b(e.id,"approved"),className:"btn btn-primary",style:{padding:"4px 12px",fontSize:"0.8rem",background:"var(--success)"},children:"Approve"}),"certified"!==e.status&&(0,s.jsx)("button",{onClick:()=>b(e.id,"certified"),className:"btn btn-primary",style:{padding:"4px 12px",fontSize:"0.8rem"},children:"Certify"}),"certified"===e.status&&(0,s.jsx)("button",{onClick:()=>b(e.id,"approved"),className:"btn btn-outline",style:{padding:"4px 12px",fontSize:"0.8rem"},children:"Decertify"}),(0,s.jsx)("button",{onClick:()=>A(e.id),className:"btn btn-outline",style:{padding:"4px 12px",fontSize:"0.8rem",color:"var(--error)",borderColor:"var(--error)"},children:"Delete"})]})})]},e.id)),0===h.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:5,style:{padding:"40px",textAlign:"center",color:"var(--text-muted)"},children:"No sensors yet"})})]})]})})]}):(0,s.jsxs)("div",{className:"container",style:{padding:"80px 24px",textAlign:"center"},children:[(0,s.jsx)("h1",{style:{color:"var(--error)"},children:"Access Denied"}),(0,s.jsx)("p",{style:{color:"var(--text-muted)",marginTop:"16px"},children:"You do not have admin privileges."})]}):(0,s.jsxs)("div",{className:"container",style:{padding:"80px 24px",textAlign:"center"},children:[(0,s.jsx)("h1",{children:"Admin Dashboard"}),(0,s.jsx)("p",{style:{color:"var(--text-muted)",marginTop:"16px"},children:"Please login to access the admin dashboard."})]})}},510:(e,t,r)=>{"use strict";r.d(t,{AuthProvider:()=>l,a:()=>d});var s=r(7437),n=r(2265),a=r(357);let i=(0,n.createContext)(void 0),o=a.env.NEXT_PUBLIC_API_URL||"/api/v1";function l(e){let{children:t}=e,[r,a]=(0,n.useState)(null),[l,d]=(0,n.useState)(null),[c,h]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=localStorage.getItem("auth_token");e?(d(e),x(e)):h(!1)},[]);let x=async e=>{try{let t=await fetch("".concat(o,"/auth/me"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();a(e)}else localStorage.removeItem("auth_token"),d(null)}catch(e){console.error("Failed to fetch user:",e)}finally{h(!1)}};return(0,s.jsx)(i.Provider,{value:{user:r,token:l,loading:c,login:()=>{window.location.href="".concat(o,"/auth/github")},logout:()=>{localStorage.removeItem("auth_token"),a(null),d(null)},completeLogin:e=>{localStorage.setItem("auth_token",e),d(e),x(e)}},children:t})}function d(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[130,215,744],()=>t(4497)),_N_E=e.O()}]);